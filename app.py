import streamlit as st
import google.generativeai as genai

# ==========================================
# ğŸ”‘ é€™è£¡è¦å¡«å…¥ä½ å‰›å‰›ç”³è«‹çš„ API Key
# ==========================================
GOOGLE_API_KEY = st.secrets["GOOGLE_API_KEY"] 

genai.configure(api_key=GOOGLE_API_KEY)
model = genai.GenerativeModel('gemini-1.5-flash')

# ==========================================
# ğŸ“‹ ä½ çš„è¡Œç¨‹è³‡æ–™
# ==========================================
TRIP_CONTEXT = """
ä½ æ˜¯ä¸€å€‹å°ˆå±¬çš„åŒ—æµ·é“æ—…éŠåŠ©ç†ï¼Œå”åŠ© 2026/1/28 - 2/6 çš„è¡Œç¨‹ã€‚
è«‹æ ¹æ“šä»¥ä¸‹è³‡æ–™å›ç­”ä½¿ç”¨è€…çš„å•é¡Œï¼š

ã€é‡é»æé†’ã€‘
- å¿…å‚™ï¼šè­·ç…§, æ—¥å¹£, Esim, å……é›»å™¨, ç¦¦å¯’è¡£ç‰©, éš±çœ¼, é«®å“(æœ‰ç·šé›»æ£’)
- ä¼´æ‰‹ç¦®ï¼šå…­èŠ±äº­(è‘¡è„å¥¶æ²¹/æ ¸æ¡ƒ), æœ­å¹Œè¾²å­¸, LeTAO, æœ­å¹Œè¾²å­¸

ã€ä½å®¿æ¸…å–®ã€‘
1/28-2/1: æœ­å¹Œç«™å‰é‡Œå£«æ»¿é£¯åº— (Richmond Hotel Sapporo Ekimae)
2/1-2/2: æ´çˆºæ¹–è¬ä¸–é–£ (æœ‰æ¥é§è»Š! 13:15 æœ­å¹Œç«™å‡ºç™¼ -> 15:45 åˆ°é£¯åº—)
2/2-2/4: å‡½é¤¨ HOTEL MYSTAYS Hakodate Station
2/4-2/6: æœ­å¹Œ Rembrandt Style Sapporo

ã€æ¯æ—¥è¡Œç¨‹ç°¡è¦ã€‘
1/28(ä¸‰): 12:30 é£› -> 17:20 åˆ°æ–°åƒæ­² -> JRå»æœ­å¹Œ -> æ™šé¤/UNIQLOè£œè²¨
1/29(å››): äºŒæ¢å¸‚å ´ -> åŒ—æµ·é“ç¥å®® -> åœ“å±±å‹•ç‰©åœ’ -> æ£®å½¥å’–å•¡ -> ç‹¸å°è·¯ -> æ¹¯å’–å“© GARAKU
1/30(äº”): å°æ¨½ä¸€æ—¥éŠ (JR 35mins) -> å ºç”ºé€š -> é‹æ²³ -> ä¸‰è§’å¸‚å ´ -> å¤©ç‹—å±±å¤œæ™¯
1/31(å…­): åŒ—æµ·é“å¤§å­¸ -> å•¤é…’åšç‰©é¤¨ -> é–‹æ‹“æ‘
2/1(æ—¥): 11:00 é€€æˆ¿ -> 13:15 æ¥é§è»Šå»æ´çˆºæ¹– -> æ™šä¸Šçœ‹æ´çˆºæ¹–ç…™ç«
2/2(ä¸€): JRæ´çˆºç«™ -> å‡½é¤¨ (ç´„2hr) -> å‡½é¤¨å±±ç™¾è¬å¤œæ™¯ (16:00é€²é¤å»³çœ‹æ—¥è½) -> é‡‘æ£®å€‰åº«
2/3(äºŒ): å‡½é¤¨æœå¸‚ -> äº”ç¨œéƒ­ -> ä¿®é“é™¢ -> æ¹¯ä¹‹å·
2/4(ä¸‰): å‡½é¤¨å›æœ­å¹Œ (JR 4hr) -> æœ­å¹Œé›ªç¥­
2/5(å››): æœ­å¹Œé›ªç¥­ (å¤§é€šå…¬åœ’/ä¸­å³¶å…¬åœ’)
2/6(äº”): 05:30 æ©Ÿå ´å·´å£«æˆ– 06:00 JR -> 09:30 é£›æ©Ÿå›å°ç£
"""

# ==========================================
# ğŸ“± App ç•«é¢è¨­å®š
# ==========================================
st.set_page_config(page_title="2026 åŒ—æµ·é“é›ªç¥­åŠ©æ‰‹", page_icon="â„ï¸")
st.title("â„ï¸ 2026 åŒ—æµ·é“ç§äººå°éŠ")

if "messages" not in st.session_state:
    st.session_state.messages = [{"role": "assistant", "content": "ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„åŒ—æµ·é“è¡Œç¨‹å°å¹«æ‰‹ã€‚æƒ³å•å“ªä¸€å¤©çš„è¡Œç¨‹ï¼Ÿæˆ–æ˜¯è¦æŸ¥äº¤é€šï¼Ÿ"}]

for msg in st.session_state.messages:
    st.chat_message(msg["role"]).write(msg["content"])

if prompt := st.chat_input("è¼¸å…¥å•é¡Œ..."):
    st.session_state.messages.append({"role": "user", "content": prompt})
    st.chat_message("user").write(prompt)
    
    with st.chat_message("assistant"):
        full_prompt = f"{TRIP_CONTEXT}\n\nä½¿ç”¨è€…å•ï¼š{prompt}\nè«‹ç”¨ç¹é«”ä¸­æ–‡ï¼Œåƒæœ‹å‹ä¸€æ¨£ç°¡çŸ­å›ç­”ã€‚å¦‚æœæ˜¯å•æ™‚é–“ï¼Œè«‹ç²¾ç¢ºå›ç­”ã€‚"
        try:
            response = model.generate_content(full_prompt)
            st.write(response.text)
            st.session_state.messages.append({"role": "assistant", "content": response.text})
        except:
            st.error("ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ API Key æ˜¯å¦æ­£ç¢ºè¨­å®šã€‚")
